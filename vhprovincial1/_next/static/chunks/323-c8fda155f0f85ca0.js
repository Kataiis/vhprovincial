"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{5323:function(t,e,n){n.r(e),n.d(e,{default:function(){return p}});var r=n(7437),i=n(7908),s=n(2265),a=n(7907),o=n(3411),u=n.n(o),c=n(8971),l=n(296),d=n(9539),h=n.n(d),f=n(703),g={src:"/vhprovincial/_next/static/media/loading.59c846ec.png",height:200,width:200,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABBElEQVR42l3IvUsCYRwH8F8hNDT11xS0u7REDS2Bo6NLSzhEDSUcZGZhkYiUd+RB14EmdxUG0Q1HBCU1BHLXiyh5SC9k+txz9tVFED/jh26BUeoBka8pFSJfgRW1Ej6YoEFMuZzl5uPzd/oYv5k4YC5bDW0tSCLG6fP0XGbXJlonIvBU8Fxb71SNHLJaAzPbXolsWXt3EpvgL0VeLxXxcPeK/D14MOnBL7g22WLOcqQUqleHXL94Q1QHptYZD6UYBKVdJ2srfeMc7eHDyEJRy/9+gXlzMY5wpo2o2tqlENHYz9nGfE1PlOV8pbO442Ihzo3pCJ+kISOr+zUpEGsu9SOp/fm64J2cSbWNU+cAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},m=n(1603),p=()=>{let t=(0,a.useRouter)(),e="https://hyggemedicalservice.com/phpapi/api",n=(0,m.C7)(t=>t.linezod),[o,d]=(0,s.useState)(!0),[p,$]=(0,s.useState)(""),[y,v]=(0,s.useState)([]),[D,w]=(0,s.useState)(),[S,M]=(0,s.useState)({}),[b,x]=(0,s.useState)(!1),[O,k]=(0,s.useState)([]),A=async(r,s)=>{console.log("lineID",n);let a=h()().format("YYYY-MM-DD HH:mm:ss"),o={req_cid:null==r?void 0:r.cid,favhos1:null==r?void 0:r.favhos1,line_id:s};console.log("dataIns",o);let c=await i.Z.post(e+"/health/hiereq/store_hyggeoa",o);if(console.log("resIns",c.data),c.data.ok){console.log("insert hie_request success");let n=await i.Z.post(e+"/health/hiereq/checkin",{cid:null==r?void 0:r.cid});if(n.data.ok){if(n.data.message<=1){u().fire({html:'<div><img src="/health-report.gif" /><p style="font-size: 16px; margin-top: 10px">กำลังดึงข้อมูลจากโรงพยาบาล</p><p style="font-size: 18px; margin-top: 10px">กรุณารอประมาณ 30 วินาที</p></div>',allowOutsideClick:!1,showConfirmButton:!1});let e="REQUEST|"+r.favhos1+"|"+(null==r?void 0:r.cid)+"|"+a;console.log("text",e),await i.Z.post("https://hyggemedicalservice.com/apirbh/connectmqtt/hyggeoa",{messagemqtt:e});let n=setTimeout(()=>{u().fire({title:"อัพเดทข้อมูลสำเร็จ",icon:"success",allowOutsideClick:!1,showConfirmButton:!1,timer:1500}).then(async()=>{t.replace("https://hyggeoa.hyggecode.com/profile2/"+(null==r?void 0:r.cid)+"/"+s)})},3e4);return()=>clearTimeout(n)}console.log("have  log in hie_request"),u().fire({title:"ข้อมูลเป็นปัจจุบันแล้ว",icon:"success",allowOutsideClick:!1,showConfirmButton:!1,timer:2e3}),t.replace("https://hyggeoa.hyggecode.com/profile2/"+(null==r?void 0:r.cid)+"/"+s)}}},Y=async()=>{c.Z.use(new l.nb),w(c.Z.getOS()),await c.Z.init({liffId:"2003919676-yBLDE8PR"}).then(async()=>{if(c.Z.isLoggedIn()){let n=await c.Z.getProfile();console.log(n),M(n),$(null==n?void 0:n.userId),console.warn(p);let r={lineid:"".concat(n.userId)};console.log("dataSend",r);let s=await i.Z.post("".concat(e,"/health/hyggelineservice/checkLineid"),r);if(s.data.ok){if(s.data.message.length>0){let t=s.data.message[0].cid,r=await i.Z.post("".concat(e,"/health/hygge_citizen/bycid"),{cid:t});if(console.log("res2.data : ",r.data),r.data.ok){if(0!=r.data.message.length){let s=r.data.message[0],a=await i.Z.post("".concat(e,"/health/phrviewlog/ins"),{cid:t,line_id:"".concat(n.userId)});if(console.log("log",a.data),h()().format("YYYY-MM-DD HH:mm:ss"),a.data.ok)A(s,"".concat(n.userId));else throw Error(a.data.error)}else throw Error(r.data.error)}}else t.replace("/login")}else throw Error(s.data.error);console.info(s.data),console.log("checkLineId",s.data)}else c.Z.login()}),await c.Z.ready};return(0,s.useEffect)(()=>{try{Y()}catch(t){console.error("liff init error",t.message)}},[]),(0,r.jsx)("div",{children:o&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex justify-center items-center w-full mt-20",children:(0,r.jsx)("div",{className:"animate-pulse flex space-x-4  justify-center items-center",children:(0,r.jsx)(f.default,{priority:!0,src:g,alt:"loading",width:100,height:100})})}),(0,r.jsx)("div",{className:"flex justify-center mt-4 text-[#65B16D]",children:(0,r.jsxs)("p",{className:"text-center font-semibold ",children:["กำลังดึงข้อมูลจากโรงพยาบาล ",(0,r.jsx)("br",{}),"กรุณารอประมาณ 30 วินาที"]})})]})})}},1603:function(t,e,n){n.d(e,{C7:function(){return a},Np:function(){return s}});var r=n(2020),i=n(5249);let s=(0,r.Ue)(t=>({patient:null,updatePatient:e=>t({patient:e})})),a=(0,r.Ue)(t=>({linezod:null,updateline:e=>t({linezod:e})}));(0,r.Ue)((0,i.mW)((0,i.tJ)((t,e)=>({userData:null,updateUserData:e=>t({userData:e})}),{name:"user",storage:(0,i.FL)(()=>sessionStorage)})))},9539:function(t){var e,n,r,i,s,a,o,u,c,l,d,h,f,g,m,p,$,y,v,D,w,S;t.exports=(e="millisecond",n="second",r="minute",i="hour",s="week",a="month",o="quarter",u="year",c="date",l="Invalid Date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},(m={})[g="en"]={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||"th")+"]"}},p="$isDayjsObject",$=function(t){return t instanceof w||!(!t||!t[p])},y=function t(e,n,r){var i;if(!e)return g;if("string"==typeof e){var s=e.toLowerCase();m[s]&&(i=s),n&&(m[s]=n,i=s);var a=e.split("-");if(!i&&a.length>1)return t(a[0])}else{var o=e.name;m[o]=e,i=o}return!r&&i&&(g=i),i||!r&&g},v=function(t,e){if($(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new w(n)},(D={s:f,z:function(t){var e=-t.utcOffset(),n=Math.abs(e);return(e<=0?"+":"-")+f(Math.floor(n/60),2,"0")+":"+f(n%60,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,a),s=n-i<0,o=e.clone().add(r+(s?-1:1),a);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return({M:a,y:u,w:s,d:"day",D:c,h:i,m:r,s:n,ms:e,Q:o})[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}}).l=y,D.i=$,D.w=function(t,e){return v(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})},S=(w=function(){function t(t){this.$L=y(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[p]=!0}var f=t.prototype;return f.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(D.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(d);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.init()},f.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},f.$utils=function(){return D},f.isValid=function(){return this.$d.toString()!==l},f.isSame=function(t,e){var n=v(t);return this.startOf(e)<=n&&n<=this.endOf(e)},f.isAfter=function(t,e){return v(t)<this.startOf(e)},f.isBefore=function(t,e){return this.endOf(e)<v(t)},f.$g=function(t,e,n){return D.u(t)?this[e]:this.set(n,t)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(t,e){var o=this,l=!!D.u(e)||e,d=D.p(t),h=function(t,e){var n=D.w(o.$u?Date.UTC(o.$y,e,t):new Date(o.$y,e,t),o);return l?n:n.endOf("day")},f=function(t,e){return D.w(o.toDate()[t].apply(o.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(e)),o)},g=this.$W,m=this.$M,p=this.$D,$="set"+(this.$u?"UTC":"");switch(d){case u:return l?h(1,0):h(31,11);case a:return l?h(1,m):h(0,m+1);case s:var y=this.$locale().weekStart||0,v=(g<y?g+7:g)-y;return h(l?p-v:p+(6-v),m);case"day":case c:return f($+"Hours",0);case i:return f($+"Minutes",1);case r:return f($+"Seconds",2);case n:return f($+"Milliseconds",3);default:return this.clone()}},f.endOf=function(t){return this.startOf(t,!1)},f.$set=function(t,s){var o,l=D.p(t),d="set"+(this.$u?"UTC":""),h=((o={}).day=d+"Date",o[c]=d+"Date",o[a]=d+"Month",o[u]=d+"FullYear",o[i]=d+"Hours",o[r]=d+"Minutes",o[n]=d+"Seconds",o[e]=d+"Milliseconds",o)[l],f="day"===l?this.$D+(s-this.$W):s;if(l===a||l===u){var g=this.clone().set(c,1);g.$d[h](f),g.init(),this.$d=g.set(c,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},f.set=function(t,e){return this.clone().$set(t,e)},f.get=function(t){return this[D.p(t)]()},f.add=function(t,e){var o,c=this;t=Number(t);var l=D.p(e),d=function(e){var n=v(c);return D.w(n.date(n.date()+Math.round(e*t)),c)};if(l===a)return this.set(a,this.$M+t);if(l===u)return this.set(u,this.$y+t);if("day"===l)return d(1);if(l===s)return d(7);var h=((o={})[r]=6e4,o[i]=36e5,o[n]=1e3,o)[l]||1,f=this.$d.getTime()+t*h;return D.w(f,this)},f.subtract=function(t,e){return this.add(-1*t,e)},f.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||l;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=D.z(this),s=this.$H,a=this.$m,o=this.$M,u=n.weekdays,c=n.months,d=n.meridiem,f=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},g=function(t){return D.s(s%12||12,t,"0")},m=d||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,function(t,r){return r||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return D.s(e.$y,4,"0");case"M":return o+1;case"MM":return D.s(o+1,2,"0");case"MMM":return f(n.monthsShort,o,c,3);case"MMMM":return f(c,o);case"D":return e.$D;case"DD":return D.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return f(n.weekdaysMin,e.$W,u,2);case"ddd":return f(n.weekdaysShort,e.$W,u,3);case"dddd":return u[e.$W];case"H":return String(s);case"HH":return D.s(s,2,"0");case"h":return g(1);case"hh":return g(2);case"a":return m(s,a,!0);case"A":return m(s,a,!1);case"m":return String(a);case"mm":return D.s(a,2,"0");case"s":return String(e.$s);case"ss":return D.s(e.$s,2,"0");case"SSS":return D.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")})},f.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},f.diff=function(t,e,c){var l,d=this,h=D.p(e),f=v(t),g=(f.utcOffset()-this.utcOffset())*6e4,m=this-f,p=function(){return D.m(d,f)};switch(h){case u:l=p()/12;break;case a:l=p();break;case o:l=p()/3;break;case s:l=(m-g)/6048e5;break;case"day":l=(m-g)/864e5;break;case i:l=m/36e5;break;case r:l=m/6e4;break;case n:l=m/1e3;break;default:l=m}return c?l:D.a(l)},f.daysInMonth=function(){return this.endOf(a).$D},f.$locale=function(){return m[this.$L]},f.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=y(t,e,!0);return r&&(n.$L=r),n},f.clone=function(){return D.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},t}()).prototype,v.prototype=S,[["$ms",e],["$s",n],["$m",r],["$H",i],["$W","day"],["$M",a],["$y",u],["$D",c]].forEach(function(t){S[t[1]]=function(e){return this.$g(e,t[0],t[1])}}),v.extend=function(t,e){return t.$i||(t(e,w,v),t.$i=!0),v},v.locale=y,v.isDayjs=$,v.unix=function(t){return v(1e3*t)},v.en=m[g],v.Ls=m,v.p={},v)}}]);